{% extends 'base.html' %}
{% block content %}
{% load bootstrap3 %}

<style>
  /* INDUSTRIAL LIGHT: SEARCH TERMINAL OVERRIDE */
  :root {
    --ios-blue: #007AFF;
    --industrial-gray: #1C1C1E;
    --technical-bg: #F2F2F7;
    --panel-bg: #FFFFFF;
    --border-stroke: #D1D1D6;
    --mono-font: 'JetBrains Mono', 'Menlo', monospace;
  }

  body {
    background-color: var(--technical-bg);
    color: var(--industrial-gray);
    font-family: 'Inter', sans-serif;
    display: block; /* Overriding your center flex for a standard layout */
    height: auto;
    overflow-y: auto;
  }

  /* SYSTEM FRAME */
  .system-search-deck {
    max-width: 1000px;
    margin: 40px auto;
    background: var(--panel-bg);
    border: 2px solid var(--industrial-gray);
    box-shadow: 10px 10px 0px rgba(0,0,0,0.05);
  }

  /* TOP CONTROL BAR */
  .control-bar {
    background: var(--industrial-gray);
    color: white;
    padding: 10px 20px;
    display: flex;
    justify-content: space-between;
    align-items: center;
    font-family: var(--mono-font);
    font-size: 11px;
    text-transform: uppercase;
  }

  .protocol-label {
    background: var(--ios-blue);
    padding: 2px 8px;
    font-weight: bold;
  }

  /* SEARCH INPUT AREA */
  .query-module {
    padding: 40px;
    border-bottom: 1px solid var(--border-stroke);
    background: #FAFAFA;
  }

  .query-input-group {
    display: flex;
    gap: 0; /* Merged industrial look */
    max-width: 800px;
    margin: 0 auto;
  }

  input[type="text"] {
    flex-grow: 1;
    background: #FFFFFF;
    border: 2px solid var(--industrial-gray);
    padding: 16px 24px;
    font-family: var(--mono-font);
    font-size: 15px;
    outline: none;
    transition: all 0.2s;
  }

  input[type="text"]:focus {
    background: #F2F2F7;
    box-shadow: inset 4px 4px 0px rgba(0,122,255,0.1);
  }

  .button1 {
    background: var(--ios-blue);
    color: white;
    border: 2px solid var(--industrial-gray);
    border-left: none;
    padding: 0 40px;
    font-family: var(--mono-font);
    font-weight: 900;
    text-transform: uppercase;
    cursor: pointer;
    transition: all 0.2s;
  }

  .button1:hover {
    background: var(--industrial-gray);
    color: var(--ios-blue);
  }

  /* RESULTS TABLE: PRECISION GRID */
  .results-module {
    padding: 40px;
  }

  .results-header {
    font-family: var(--mono-font);
    font-size: 12px;
    font-weight: bold;
    margin-bottom: 20px;
    color: #8E8E93;
    display: flex;
    justify-content: space-between;
  }

  table {
    width: 100%;
    border-collapse: collapse;
    font-family: var(--mono-font);
  }

  th {
    background: var(--technical-bg);
    border: 1px solid var(--border-stroke);
    padding: 12px 15px;
    font-size: 11px;
    text-transform: uppercase;
    color: var(--industrial-gray);
    text-align: left;
  }

  td {
    border: 1px solid var(--border-stroke);
    padding: 15px;
    font-size: 13px;
    color: var(--industrial-gray);
  }

  tr:nth-child(even) { background: #FAFAFA; }

  tr:hover {
    background: #F2F2F7;
    outline: 1px solid var(--ios-blue);
  }

  td a {
    color: var(--ios-blue);
    text-decoration: none;
    font-weight: bold;
  }

  td a:hover { text-decoration: underline; }

  .no-results {
    font-family: var(--mono-font);
    color: #FF3B30; /* System Red */
    text-align: center;
    padding: 40px;
    font-size: 13px;
    background: #FFF5F5;
    border: 1px dashed #FF3B30;
  }

  /* RESPONSIVE */
  @media (max-width: 768px) {
    .query-input-group { flex-direction: column; gap: 10px; }
    .button1 { border-left: 2px solid var(--industrial-gray); padding: 15px; }
    .system-search-deck { margin: 10px; }
  }
</style>

<div class="system-search-deck">
  <div class="control-bar">
    <div><span class="protocol-label">QUERY</span> DATA_RETRIEVAL_SERVICE</div>
    <div id="sys-clock">00:00:00</div>
  </div>

  <div class="query-module">
    <form method="get">
      <div class="query-input-group">
        <input type="text" name="query" maxlength="100" placeholder="ENTER_SKU_OR_ITEM_ID..." value="{{ request.GET.query }}">
        {% csrf_token %}
        <button type="submit" id="id_search" class="button1">EXECUTE</button>
      </div>
    </form>
  </div>

  <div class="results-module">
    {% if results %}
    <div class="results-header">
      <span>MATCH_FOUND: {{ results|length }} RECORDS</span>
      <span>INDEX_SORT: TIMESTAMP_DESC</span>
    </div>
    <table>
      <thead>
        <tr>
          <th>[ID] OBJECT_NOMENCLATURE</th>
          <th>TIMESTAMP</th>
          <th>SEC_LOCATION</th>
        </tr>
      </thead>
      <tbody>
        {% for manufacturer in results %}
        <tr>
          <td><a href="{% url 'manufacturer_detail' manufacturer.pk %}">{{ manufacturer.item|upper }}</a></td>
          <td>{{ manufacturer.date_added|date:'Y.m.d // H:i' }}</td>
          <td>{{ manufacturer.location|upper }}</td>
        </tr>
        {% endfor %}
      </tbody>
    </table>
    {% elif request.GET.query %}
    <div class="no-results">
      ERROR_404: NO_RECORDS_MATCH_STRING ["{{ request.GET.query }}"]
    </div>
    {% else %}
    <div class="results-header" style="justify-content: center;">
      AWAITING_QUERY_INPUT...
    </div>
    {% endif %}
  </div>
</div>

<script>
  function updateClock() {
    const now = new Date();
    document.getElementById('sys-clock').innerText = now.toTimeString().split(' ')[0];
  }
  setInterval(updateClock, 1000);
  updateClock();
</script>
{% endblock content %}